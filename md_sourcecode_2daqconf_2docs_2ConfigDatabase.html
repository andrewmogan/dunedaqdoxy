<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DUNE-DAQ: Interacting with the Configuration Database</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DUNE-DAQ
   </div>
   <div id="projectbrief">DUNE Trigger and Data Acquisition software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Interacting with the Configuration Database</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md248"></a> </p>
<h1><a class="anchor" id="autotoc_md249"></a>
Uploading a config</h1>
<p>To use configuration files with a <em>nanorc</em> instance run on Kubernetes, the config first needs to be uploaded to the MongoDB running in the cluster. To do this, simply run <code>upload-conf &lt;the_conf_dir/&gt; &lt;name-for-the-conf&gt;</code>.</p>
<p><em>nanorc</em> should then be started with <code>nanorc --pm k8s://np04-srv-015:31000 db://name-for-the-conf partition-name</code></p>
<p>Keep in mind that the config directory can contain underscores, but the name it will be given in the database cannot (hyphens are fine).</p>
<h1><a class="anchor" id="autotoc_md250"></a>
Viewing configurations</h1>
<p>To inspect the contents of the database, run <code>daqconf_viewer</code> after setting up the software environment. This will open a graphical UI in the terminal. There are five optional arguments that can be provided:</p><ul>
<li>&ndash;conf-host and reg-host to manually enter the host of the microservices (defaults to <a href="http://np04-srv-023">http://np04-srv-023</a> and <a href="http://dunedaq-microservices.cern.ch">http://dunedaq-microservices.cern.ch</a>)</li>
<li>&ndash;conf-port and reg-port to manually enter the port that the service listens on (defaults to 31011 and 5005)</li>
<li>&ndash;dir to tell the config viewer where to look for local config files (defaults to ./) <img src="ConfViewerScreenshot.png" alt="Config Viewer" class="inline"/></li>
</ul>
<p>A list of all configuration names is shown on the left. It can be filtered using the search bar above it. Clicking one of these names will generate a list of buttons at the top, corresponding to the saved versions of the config. The versions are displayed in descending order by default, but this can be changed with the V key. Click one of the buttons to bring up the config file in the display box. By clicking the arrows, the contents of each sub-schema can be expanded.</p>
<p>Additionally, you can press the L key to switch between viewing the database and viewing local files. The config list will be replaced with a tree representing the contents of the directory given with &ndash;dir. <img src="ConfViewerLocalScreenshot.png" alt="Local Configs" class="inline"/></p>
<p>Pressing the D key after picking a config will take you to a very similar screen, albeit with green lines instead of red. If a second config is selected using the previously defined process, then a "diff" of the two will be generated, showing all the differences between the two in a format similar to how commits are displayed on github. Again, the L key can be used to switch to local files, allowing for comparisons of local and DB configs in any combination. Finally, once you are done press q to quit (or use ctrl+c).</p>
<h1><a class="anchor" id="autotoc_md251"></a>
Interacting with the run registry</h1>
<p>Pressing the R key while on the first screen will take you to the run registry screen. Metadata for the chosen run is shown in the top right, and the associated config files are displayed in a tree on the bottom left. Selecting one brings up the JSON on the bottom right, with expandable schema as before. <img src="RunRegScreenshot.png" alt="Run Reg Viewer" class="inline"/></p>
<p>When the application is initialised, the most recent run is shown by default. To navigate to different runs, simply click the back/forward buttons, or type the desired run into the input box and click the Get Data button. The R key can be used to return to browsing the MongoDB when you are done. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
