<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DUNE-DAQ: ConfigurationsForCasualUsers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">DUNE-DAQ
   </div>
   <div id="projectbrief">DUNE Trigger and Data Acquisition software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">ConfigurationsForCasualUsers</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The intention of this page is to provide a few simple configurations that new or casual users can use in order to test the operation of a small demo system that uses emulators instead of real electronics.</p>
<p>After you have successfully followed the steps described in <a class="el" href="md_sourcecode_2daqconf_2docs_2InstructionsForCasualUsers.html">Instructions for casual or first-time users</a>, we will focus now on a few variations to the default configuration used in those instructions.</p>
<p>First, a reminder to set up your working software environment and download the fake input data file</p><ol type="1">
<li><code>cd &lt;work_dir&gt;</code></li>
<li><code>source ./dbt-env.sh</code></li>
<li><code>dbt-workarea-env</code></li>
<li><code>curl -o frames.bin -O <a href="https://cernbox.cern.ch/index.php/s/0XzhExSIMQJUsp0/download">https://cernbox.cern.ch/index.php/s/0XzhExSIMQJUsp0/download</a></code></li>
</ol>
<p>Next we generate some sample system configurations and use <em><a href="https://dune-daq-sw.readthedocs.io/en/latest/packages/nanorc/">nanorc</a></em> to run a demo system with them.</p>
<p>The tools to generate these configurations consist of a single Python script that generates DAQ system configurations with different characteristics based on the configuration file given to the script. This script is <code>daqconf/scripts/fddaqconf_gen</code>. It uses <code>daqconf/schema/daqconf/confgen.jsonnet</code> to define the format for configuration JSON files. The configuration generation files under the <code>daqconf/python/daqconf/apps</code> directory were developed to work with the <em>nanorc</em> package, which itself can be seen as a basic Finite State Machine that sends commands and drives the DAQ system.</p>
<p>Here is an example command line which uses the provided JSON file that has all of the default values populated (so it is equivalent to running without any options at all!). Note for the reader that it scrolls horizontally. The command below assumes you also have a hardware map file available, e.g. <a href="https://raw.githubusercontent.com/DUNE-DAQ/daq-systemtest/develop/config/default_system/default_system_HardwareMap.txt">this basic example</a>. Further details on hardware map files can be found at the bottom of this page. </p><div class="fragment"><div class="line">fddaqconf_gen --hardware-map-file &lt;your hardware map file&gt; --config daqconf/config/daqconf_full_config.json daq_fake00</div>
</div><!-- fragment --><p> The created configurations will be called <code>daq_fake&lt;NN&gt;</code> and there will be a <code>daq_fake&lt;NN&gt;</code> directory created containing the produced configuration to be used with <em>nanorc</em>. The configurations can be run interactively with <code>nanorc daq_fake&lt;NN&gt; &lt;partition_name&gt;</code> from the <code>&lt;work_dir&gt;</code>.</p>
<p>In the following sections, we will use "dot" notation to indicate JSON paths, so that <code>readout.data_file $PWD/frames.bin</code> is equvalent to <code>"readout": { "data_file": "$PWD/frames.bin" }</code>.</p>
<p>1) In order to get the set of configuration options that can be overridden from the command line and their <code>help</code> , run : <code>fddaqconf_gen -h</code> Command-line options override any options set in the configuration file, which in turn override any default values.</p>
<p>2) The data <code>Input</code> and <code>Output</code> system configuration options allow the user to change the input data file location and the output data directory path as needed. To specify an input <code>frames.bin</code> file from the current directory, a user would use <code>readout.data_file $PWD/frames.bin</code>. This file contains data frames that are replayed by fake cards in the current system, and as mentioned above, this file can be downloaded with "`curl -o frames.bin -O https://cernbox.cern.ch/index.php/s/7qNnuxD8igDOVJT/download`". The output data path option <code>dataflow.apps[n].output_dirs</code> can be used to specify the directory where output data files are written. If more than one path is provided in the array, the DataWriter will use those directories in rotation for writting TriggerRecords.</p>
<p>3) The default trigger rate generated is 1 Hz per readout unit (RU). This can be changed with the option <code>trigger.trigger_rate_hz FLOAT</code> (default 1.0 Hz).</p>
<p>4) Use option <code>readout.data_rate_slowdown_factor INTEGER</code> to slow down the generated data rate by a factor of INTEGER, this is achieved by slowing down the simulated clock speed for generating data. This option is particularly useful when the user is running the system on a slow computer that can't create data fast enough to match what the real electronics can do.</p>
<p>5) Use options <code>dataflow.apps[n].host_df TEXT</code> , <code>trigger.host_trigger TEXT</code> , <code>hsi.host_hsi TEXT</code> to specify different hosts for the different applications (processes). The default for any unspecified host options will be <code>localhost</code></p>
<p>6) As described in the <em>nanorc</em> documentation, running <em>nanorc</em> can be done in interactively or in batch mode. For batch mode you can specify a sequence of commands to drive MiniDAQ app, for example run :</p>
<p><code>nanorc daq_fake03 &lt;partition_name&gt; boot conf start_run 103 wait 60 stop_run shutdown</code></p>
<p>The <code>start_run &lt;run_number&gt;</code> command specifies the run_number value to be used. Any meaningful combination of commands is allowed. Note that the <code>start_run</code> command includes an automatically-generated <code>enable_triggers</code> command to start the flow of triggers, and the <code>stop_run</code> command includes an automatically-generated <code>disable_triggers</code> command to stop the flow of triggers.</p>
<p>7) Examine the contents of the HDf5 file with commands like the following:</p><ul>
<li><code>h5dump-shared -H -A swtest_run000103_0000_*.hdf5</code></li>
<li>and</li>
<li><code><a class="el" href="hdf5__dump_8py.html">hdf5_dump.py</a> -p both -f swtest_run000103_0000_*.hdf5</code></li>
</ul>
<p>For more on <code><a class="el" href="hdf5__dump_8py.html">hdf5_dump.py</a></code>, run <code><a class="el" href="hdf5__dump_8py.html">hdf5_dump.py</a> -h</code>.</p>
<p>8) Some examples:</p>
<p>slowdown_conf.json (Applying the data slowdown factor from point 4): </p><div class="fragment"><div class="line">{</div>
<div class="line">&quot;readout&quot;: {</div>
<div class="line">  &quot;data_rate_slowdown_factor&quot;: 10</div>
<div class="line">}</div>
<div class="line">}</div>
</div><!-- fragment --><p> <code>fddaqconf_gen --config slowdown_conf.json daq_fake01</code></p>
<p>multi_df.json (Running two dataflow apps): </p><div class="fragment"><div class="line">{</div>
<div class="line">&quot;dataflow&quot;:{</div>
<div class="line">&quot;apps&quot;: [</div>
<div class="line">{&quot;app_name&quot;: &quot;dataflow0&quot;, &quot;output_dir&quot;: &quot;/data1&quot;, &quot;host_df&quot;: 127.0.0.1 },</div>
<div class="line">{&quot;app_name&quot;: &quot;dataflow1&quot;, &quot;output_dir&quot;: &quot;/data2&quot;, &quot;host_df&quot;: 127.0.0.2 }</div>
<div class="line">]</div>
<div class="line">}</div>
<div class="line">}</div>
</div><!-- fragment --><p> <code>fddaqconf_gen --config multi_df.json daq_fake02</code></p>
<p>9) One of the key options is the <code>--detector-readout-map-file</code>, or <code>readout.detector_readout_map_file</code>, which points the configuration generators to a JSON file describing the readout links in the current configuration. It can be generated using <a href="https://github.com/DUNE-DAQ/daqconf/blob/develop/test/scripts/daqconf_dromap_gen">this utility from daqconf</a> and edited using <a href="https://github.com/DUNE-DAQ/daqconf/blob/develop/scripts/dromap_editor">this utility</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
